<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <title>Event Reviews</title>

    <style>
        .rating {
            display: inline-block;
            direction:rtl;
        }

        .rating input[type="radio"] {
            display: none;
        }

        .rating label {
            font-size: 30px;
            color: #ccc;
            cursor: pointer;
        }

        .rating label:before {
            content: "\2605";
        }

        .rating input[type="radio"]:checked ~ label {
            color: gold;
        }
    </style>


</head>
<body>

<h2>Event Reviews</h2>
<h2>Average Rating: <span id="averageRating" th:text="${averageRating}"></span></h2>
<!--<h2>Number of Techies attending this event: <span id="attendees" th:text="${event.attendeeCount}"></span></h2>-->
<!-- Registration section -->
<div sec:authorize="isAuthenticated()">
    <h2>Register for Event</h2>
    <form th:action="@{/event/{eventId}/register(eventId=${event.eventId})}" method="post" th:object="${attendee}">
        <input type="hidden" th:value="${userId}" name="userId" />
        <input type="hidden" th:value="${event.eventId}" name="eventId" />
        <button type="submit">Register for this event</button>
    </form>
</div>

<table>
    <thead>
    <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Rating</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td th:text="${event.title}"></td>
        <td th:text="${event.dateTime}"></td>
        <td th:text="${event.description}"></td>
        <td th:text="${event.location}"></td>
    </tr>

    <!--        All Reviews need to be pushed in the bottom of the form -->
    <tr th:each="review : ${reviews}">
        <td th:text="${review.title}"></td>
        <td th:text="${review.description}"></td>
        <td th:text="${review.rating}"></td>
    </tr>
    </tbody>
</table>


<!--    Review form only seen when a user is LoggedIn-->


<div sec:authorize="isAuthenticated()">

    <h2>Create Event Review</h2>

    <form th:action="@{/event/{eventId}/reviews/create(eventId=${event.eventId})}" method="post"
          th:object="${review}">

        <!--        Intakes the user id as a hidden input-->

<!--        <input type="hidden" th:value="${loggedUserid}" th:field="*{user}"/>-->

        <label for="title">Title:</label>
        <input type="text" id="title" name="title" th:field="*{title}"/>

        <label for="description">Description:</label>
        <textarea id="description" name="description" th:field="*{description}"></textarea>

        <fieldset>
            <legend>Rating:</legend>
            <div class="rating">
                <input type="radio" id="star5" name="*{rating}" th:field="*{rating}" value="5" th:checked="${review.rating == 5}"/>
                <label for="star5"></label>
                <input type="radio" id="star4" name="*{rating}" th:field="*{rating}" value="4" th:checked="${review.rating == 4}"/>
                <label for="star4"></label>
                <input type="radio" id="star3" name="*{rating}" th:field="*{rating}" value="3" th:checked="${review.rating == 3}"/>
                <label for="star3"></label>
                <input type="radio" id="star2" name="*{rating}" th:field="*{rating}" value="2" th:checked="${review.rating == 2}"/>
                <label for="star2"></label>
                <input type="radio" id="star1" name="*{rating}" th:field="*{rating}" value="1" th:checked="${review.rating == 1}"/>
                <label for="star1"></label>
            </div>
        </fieldset>


        <button type="submit">Save Review</button>


    </form>
</div>
<div sec:authorize="isAnonymous()">
    <p>Please log in to submit a review.</p>
</div>





</body>
</html>
