<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Event Reviews</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>

<table>
    <thead>
    <tr>
        <th>Title</th>
        <th>Date/Time</th>
        <th>Description</th>
        <th>Location</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td th:text="${event.title}"></td>
        <td th:text="${event.dateTime}"></td>
        <td th:text="${event.description}"></td>
        <td th:text="${event.location}"></td>
    </tr>
    </tbody>
</table>

<div sec:authorize="isAuthenticated()">

    <h2>Create Event Review</h2>

    <form th:action="@{/event/{eventId}/reviews/create(eventId=${event.eventId})}" method="post"
          th:object="${review}">

        <!--        Intakes the user id as a hidden input-->

        <label for="title">Title:</label>
        <input type="text" id="title" name="title" th:field="*{title}"/>

        <label for="description">Description:</label>
        <textarea id="description" name="description" th:field="*{description}"></textarea>

        <fieldset>
            <legend>Rating:</legend>
            <div class="rating">
                <input type="radio" id="star5" name="*{rating}" value="5" th:checked="${review.rating == 5}"/>
                <label for="star5"></label>
                <input type="radio" id="star4" name="*{rating}" value="4" th:checked="${review.rating == 4}"/>
                <label for="star4"></label>
                <input type="radio" id="star3" name="*{rating}" value="3" th:checked="${review.rating == 3}"/>
                <label for="star3"></label>
                <input type="radio" id="star2" name="*{rating}" value="2" th:checked="${review.rating == 2}"/>
                <label for="star2"></label>
                <input type="radio" id="star1" name="*{rating}" value="1" th:checked="${review.rating == 1}"/>
                <label for="star1"></label>
            </div>
        </fieldset>

        <button type="submit">Save Review</button>

    </form>
</div>

<!--<div sec:authorize="isAnonymous()">-->
<!--    <p>Please log in to submit a review.</p>-->
<!--</div>-->

<h2>Event Reviews</h2>

<table>
    <thead>
    <tr>
        <th>Review Title</th>
        <th>Review Description</th>
        <th>Review Rating</th>
    </tr>
    </thead>
    <tbody>

    <tr th:each="review : ${reviews}">
        <!-- Existing review display -->
        <td class="review-title-display" th:text="${review.title}"></td>
        <td class="review-description-display" th:text="${review.description}"></td>
        <td th:text="${review.rating}"></td>
        <td>
            <div sec:authorize="isAuthenticated()">
                <button class="edit-review-button">Edit</button>
                <form th:action="@{/event/{eventId}/reviews/{reviewId}/delete(eventId=${event.eventId}, reviewId=${review.id})}"
                      method="post"
                      onsubmit="return confirm('Are you sure you want to delete this review?');">
                    <input type="hidden" name="_method" value="delete"/>
                    <button type="submit">Delete</button>
                </form>
            </div>

            <!-- Edit review form -->
            <form class="edit-review-form"
                  th:action="@{/event/{eventId}/reviews/{reviewId}/edit(eventId=${event.eventId}, reviewId=${review.id})}"
                  method="post"
                  style="display: none;">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" class="edit-review-title" value=""/>
                <label for="description">Description:</label>
                <textarea id="description" name="description" class="edit-review-description"></textarea>
                <button type="submit">Update Review</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<script>
    $(document).ready(function () {
        $('.edit-review-button').click(function () {
            var row = $(this).closest('tr');
            var title = row.find('.review-title-display').text();
            var description = row.find('.review-description-display').text();

            var formDiv = row.find('.edit-review-form');
            formDiv.find('.edit-review-title').val(title);
            formDiv.find('.edit-review-description').val(description);

            formDiv.show();
            row.find('.edit-review-button').hide();
        });
    });
</script>


</body>
</html>


